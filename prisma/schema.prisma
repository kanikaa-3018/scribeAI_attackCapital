generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SessionStatus {
  RECORDING
  PAUSED
  PROCESSING
  COMPLETED
  ERROR
}

model User {
  id       String    @id @default(cuid())
  email    String    @unique
  name     String?
  sessions Session[]
}

model Session {
  id               String        @id @default(cuid())
  title            String
  ownerId          String        @map("owner_id")
  owner            User          @relation(fields: [ownerId], references: [id])
  status           SessionStatus
  startedAt        DateTime
  endedAt          DateTime?
  transcript       String
  summary          String?
  clientSessionId  String?       @map("client_session_id")
  AudioChunks      AudioChunk[]
  ActionItems      ActionItem[]
}

model AudioChunk {
  id        String   @id @default(cuid())
  sessionId String   @map("session_id")
  session   Session  @relation(fields: [sessionId], references: [id])
  sequence  Int
  timestamp DateTime
  text      String
  speaker   String?  // Speaker label from diarization (e.g., "Speaker 1")
}

model ActionItem {
  id          String   @id @default(cuid())
  sessionId   String   @map("session_id")
  session     Session  @relation(fields: [sessionId], references: [id])
  type        ActionItemType // task, decision, question
  description String
  assignee    String?  // Extracted name if mentioned
  deadline    String?  // Extracted deadline if mentioned
  timestamp   DateTime @default(now())
}

enum ActionItemType {
  TASK
  DECISION
  QUESTION
}
